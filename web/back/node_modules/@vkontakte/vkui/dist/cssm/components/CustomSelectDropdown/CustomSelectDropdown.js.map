{"version":3,"sources":["../../../../src/components/CustomSelectDropdown/CustomSelectDropdown.tsx"],"names":["React","CustomScrollView","classNames","Popper","Spinner","calcIsTop","placement","includes","CustomSelectDropdown","children","targetRef","scrollBoxRef","fetching","parentOnPlacementChange","onPlacementChange","offsetDistance","sameWidth","forcePortal","restProps","useState","isTop","setIsTop","customModifiers","useMemo","current","name","enabled","phase","effect","instance","observer","MutationObserver","forceUpdate","observe","childList","disconnect","useCallback"],"mappings":";;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAEA,SAASC,gBAAT;AACA,SAASC,UAAT;AACA,SAASC,MAAT;AACA,SAASC,OAAT;AAEA;;AAeA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,SAAD;AAAA,SAA2BA,SAA3B,aAA2BA,SAA3B,uBAA2BA,SAAS,CAAEC,QAAX,CAAoB,KAApB,CAA3B;AAAA,CAAlB;;AAEA,OAAO,IAAMC,oBAAyD,GAAG,SAA5DA,oBAA4D,OAWnE;AAAA,MAVJC,QAUI,QAVJA,QAUI;AAAA,MATJC,SASI,QATJA,SASI;AAAA,MARJC,YAQI,QARJA,YAQI;AAAA,MAPJL,SAOI,QAPJA,SAOI;AAAA,MANJM,QAMI,QANJA,QAMI;AAAA,MALeC,uBAKf,QALJC,iBAKI;AAAA,iCAJJC,cAII;AAAA,MAJJA,cAII,oCAJa,CAIb;AAAA,4BAHJC,SAGI;AAAA,MAHJA,SAGI,+BAHQ,IAGR;AAAA,8BAFJC,WAEI;AAAA,MAFJA,WAEI,iCAFU,IAEV;AAAA,MADDC,SACC;;AACJ,wBAA0BlB,KAAK,CAACmB,QAAN,CAAe;AAAA,WAAMd,SAAS,CAACC,SAAD,CAAf;AAAA,GAAf,CAA1B;AAAA;AAAA,MAAOc,KAAP;AAAA,MAAcC,QAAd;;AAEA,MAAMC,eAAe,GAAGtB,KAAK,CAACuB,OAAN,CAAuC,YAAM;AACnE,QAAI,EAACZ,YAAD,aAACA,YAAD,eAACA,YAAY,CAAEa,OAAf,CAAJ,EAA4B;AAC1B,aAAO,EAAP;AACD;;AAED,WAAO,CACL;AACEC,MAAAA,IAAI,EAAE,4BADR;AAEEC,MAAAA,OAAO,EAAE,IAFX;AAGEC,MAAAA,KAAK,EAAE,MAHT;AAIEC,MAAAA,MAAM,EAAE,uBAAkB;AAAA,YAAfC,QAAe,SAAfA,QAAe;AACxB,YAAMC,QAAQ,GAAG,IAAIC,gBAAJ,CAAqBF,QAAQ,CAACG,WAA9B,CAAjB;AAEAF,QAAAA,QAAQ,CAACG,OAAT,CAAiBtB,YAAY,CAACa,OAA9B,EAAkD;AAChDU,UAAAA,SAAS,EAAE;AADqC,SAAlD;AAIA,eAAO,YAAM;AACXJ,UAAAA,QAAQ,CAACK,UAAT;AACD,SAFD;AAGD;AAdH,KADK,CAAP,CALmE,CAuBnE;AACD,GAxBuB,EAwBrB,CAACxB,YAAD,aAACA,YAAD,uBAACA,YAAY,CAAEa,OAAf,CAxBqB,CAAxB;AA0BA,MAAMV,iBAAiB,GAAGd,KAAK,CAACoC,WAAN,CACxB,iBAA8C;AAAA,QAA3C9B,SAA2C,SAA3CA,SAA2C;AAC5Ce,IAAAA,QAAQ,CAAChB,SAAS,CAACC,SAAD,CAAV,CAAR;AACAO,IAAAA,uBAAuB,SAAvB,IAAAA,uBAAuB,WAAvB,YAAAA,uBAAuB,CAAGP,SAAH,CAAvB;AACD,GAJuB,EAKxB,CAACO,uBAAD,EAA0BQ,QAA1B,CALwB,CAA1B;AAQA,SACE,oBAAC,MAAD;AACE,IAAA,SAAS,EAAEX,SADb;AAEE,IAAA,cAAc,EAAEK,cAFlB;AAGE,IAAA,SAAS,EAAEC,SAHb;AAIE,IAAA,iBAAiB,EAAEF,iBAJrB;AAKE,IAAA,SAAS,EAAER,SALb;AAME,IAAA,SAAS,EAAEJ,UAAU,CACnB,sBADmB,EAEnBa,cAAc,KAAK,CAAnB,KACGK,KAAK,GACF,2BADE,GAEF,8BAHN,CAFmB,EAMnBJ,SAAS,IAAI,4BANM,CANvB;AAcE,IAAA,WAAW,EAAEC,WAdf;AAeE,IAAA,eAAe,EAAEK;AAfnB,KAgBMJ,SAhBN,GAkBE,oBAAC,gBAAD;AACE,IAAA,MAAM,EAAEP,YADV;AAEE,IAAA,SAAS,EAAC;AAFZ,KAIGC,QAAQ,GACP;AAAK,IAAA,SAAS,EAAC;AAAf,KACE,oBAAC,OAAD;AAAS,IAAA,IAAI,EAAC;AAAd,IADF,CADO,GAKPH,QATJ,CAlBF,CADF;AAiCD,CAjFM","sourcesContent":["import * as React from \"react\";\nimport { Modifier } from \"react-popper\";\nimport { CustomScrollView } from \"../CustomScrollView/CustomScrollView\";\nimport { classNames } from \"../../lib/classNames\";\nimport { Popper, Placement } from \"../Popper/Popper\";\nimport { Spinner } from \"../Spinner/Spinner\";\nimport { HasRef } from \"../../types\";\nimport \"./CustomSelectDropdown.css\";\n\nexport interface CustomSelectDropdownProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasRef<HTMLDivElement> {\n  targetRef: React.RefObject<HTMLElement>;\n  placement?: Placement;\n  scrollBoxRef?: React.RefObject<HTMLDivElement>;\n  fetching?: boolean;\n  offsetDistance?: number;\n  sameWidth?: boolean;\n  forcePortal?: boolean;\n  onPlacementChange?: (placement?: Placement) => void;\n}\n\nconst calcIsTop = (placement?: Placement) => placement?.includes(\"top\");\n\nexport const CustomSelectDropdown: React.FC<CustomSelectDropdownProps> = ({\n  children,\n  targetRef,\n  scrollBoxRef,\n  placement,\n  fetching,\n  onPlacementChange: parentOnPlacementChange,\n  offsetDistance = 0,\n  sameWidth = true,\n  forcePortal = true,\n  ...restProps\n}) => {\n  const [isTop, setIsTop] = React.useState(() => calcIsTop(placement));\n\n  const customModifiers = React.useMemo<Array<Modifier<string>>>(() => {\n    if (!scrollBoxRef?.current) {\n      return [];\n    }\n\n    return [\n      {\n        name: \"customSelectChildrenChange\",\n        enabled: true,\n        phase: \"main\",\n        effect: ({ instance }) => {\n          const observer = new MutationObserver(instance.forceUpdate);\n\n          observer.observe(scrollBoxRef.current as Element, {\n            childList: true,\n          });\n\n          return () => {\n            observer.disconnect();\n          };\n        },\n      },\n    ];\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [scrollBoxRef?.current]);\n\n  const onPlacementChange = React.useCallback(\n    ({ placement }: { placement?: Placement }) => {\n      setIsTop(calcIsTop(placement));\n      parentOnPlacementChange?.(placement);\n    },\n    [parentOnPlacementChange, setIsTop]\n  );\n\n  return (\n    <Popper\n      targetRef={targetRef}\n      offsetDistance={offsetDistance}\n      sameWidth={sameWidth}\n      onPlacementChange={onPlacementChange}\n      placement={placement}\n      vkuiClass={classNames(\n        \"CustomSelectDropdown\",\n        offsetDistance === 0 &&\n          (isTop\n            ? \"CustomSelectDropdown--top\"\n            : \"CustomSelectDropdown--bottom\"),\n        sameWidth && \"CustomSelectDropdown--wide\"\n      )}\n      forcePortal={forcePortal}\n      customModifiers={customModifiers}\n      {...restProps}\n    >\n      <CustomScrollView\n        boxRef={scrollBoxRef}\n        vkuiClass=\"CustomSelectDropdown__in\"\n      >\n        {fetching ? (\n          <div vkuiClass=\"CustomSelectDropdown__fetching\">\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          children\n        )}\n      </CustomScrollView>\n    </Popper>\n  );\n};\n"],"file":"CustomSelectDropdown.js"}