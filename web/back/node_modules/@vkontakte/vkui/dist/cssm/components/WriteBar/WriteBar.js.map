{"version":3,"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"names":["React","usePlatform","useExternRef","hasReactNode","isFunction","getClassName","WriteBar","props","platform","className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange","restProps","isControlledOutside","textareaRef","currentScrollHeight","useRef","resize","useCallback","textareaEl","current","offsetParent","height","scrollHeight","onTextareaChange","event","useEffect","e","preventDefault"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { hasReactNode, isFunction } from \"../../lib/utils\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { HasRef, HasRootRef } from \"../../types\";\nimport \"./WriteBar.css\";\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n\n  children?: never;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar: React.FC<WriteBarProps> = (props: WriteBarProps) => {\n  const platform = usePlatform();\n  const {\n    className,\n    style,\n\n    before,\n    inlineAfter,\n    after,\n\n    value,\n    onChange,\n\n    getRootRef,\n    getRef,\n    onHeightChange,\n    ...restProps\n  } = props;\n\n  const isControlledOutside = value != null;\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = \"\";\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (\n        textareaEl.scrollHeight !== currentScrollHeight.current &&\n        onHeightChange\n      ) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  const onTextareaChange: React.ChangeEventHandler<HTMLTextAreaElement> = (\n    event\n  ) => {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  React.useEffect(() => {\n    resize();\n  }, [resize, value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      vkuiClass={getClassName(\"WriteBar\", platform)}\n      className={className}\n      style={style}\n    >\n      <form vkuiClass=\"WriteBar__form\" onSubmit={(e) => e.preventDefault()}>\n        {hasReactNode(before) && (\n          <div vkuiClass=\"WriteBar__before\">{before}</div>\n        )}\n\n        <div vkuiClass=\"WriteBar__formIn\">\n          <textarea\n            {...restProps}\n            vkuiClass=\"WriteBar__textarea\"\n            onChange={onTextareaChange}\n            ref={textareaRef}\n            value={value}\n          />\n\n          {hasReactNode(inlineAfter) && (\n            <div vkuiClass=\"WriteBar__inlineAfter\">{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div vkuiClass=\"WriteBar__after\">{after}</div>}\n      </form>\n    </div>\n  );\n};\n"],"file":"WriteBar.js"}